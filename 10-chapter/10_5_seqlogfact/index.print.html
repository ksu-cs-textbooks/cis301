




	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 301: Logical Foundations of Programming">
    <meta name="author" content="Julie Thornton">
    <title>Logika Facts, revisited :: CIS 301 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/index.html" rel="canonical" type="text/html" title="Logika Facts, revisited :: CIS 301 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/index.xml" rel="alternate" type="application/rss+xml" title="Logika Facts, revisited :: CIS 301 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/tele.html" rel="alternate" type="text/html" title="Logika Facts, revisited :: CIS 301 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/embed.html" rel="alternate" type="text/html" title="Logika Facts, revisited :: CIS 301 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/fontawesome-all.min.css?1700084028" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis301/css/fontawesome-all.min.css?1700084028" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/nucleus.css?1700084028" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/auto-complete.css?1700084028" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis301/css/auto-complete.css?1700084028" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/perfect-scrollbar.min.css?1700084028" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/fonts.css?1700084028" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis301/css/fonts.css?1700084028" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/theme.css?1700084028" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/theme-auto.css?1700084028" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/variant.css?1700084028" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/print.css?1700084028" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/format-print.css?1700084028" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/ie.css?1700084028" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis301/js/url.js?1700084028"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis301/js/variant.js?1700084028"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis301/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis301/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis301/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis301/css/custom.css?1700084028" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/10_5_seqlogfact/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis301/index.html"><span itemprop="name">CIS 301 Textbook</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis301/10-chapter/index.html"><span itemprop="name">Sequences, Globals, and Termination</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Logika Facts, revisited</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="logika-facts-revisited">Logika Facts, revisited</h1>

<p>As in other programs with loops, programs with sequences sometimes necessitate the use of a <em>Logika fact</em> to describe how a particular value is calculated. For example, consider the following program that finds and returns the sum of all elements in an integer sequence:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>import org.sireum.logika._
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def seqSum(list: ZS): Z = {
</span></span><span style="display:flex;"><span>    var i: Z = 0
</span></span><span style="display:flex;"><span>    var total: Z = 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    while (i &lt; list.size) {
</span></span><span style="display:flex;"><span>        total = total + list(i)
</span></span><span style="display:flex;"><span>        i = i + 1
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    return total
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>////////////// Calling code ///////////////////
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>var test: ZS = ZS(1,2,3,4)
</span></span><span style="display:flex;"><span>var added: Z = seqSum(test)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>assert(added == 10)</span></span></code></pre></div><p>In the <code>seqSum</code> function contract, we need to describe that the return value equals the sum of all sequence elements &ndash; that is, that <code>result == list(0) + list(1) + ... + list(list.size - 1)</code>. This is the same situation that we encountered when trying to specify something like a factorial. We know the pattern that we want to describe, but aren&rsquo;t able to do so without using the &ldquo;&hellip;&rdquo; notation. When you need to describe a pattern in this way, you will almost always want to use a Logika fact.</p>
<h2 id="blueprint-for-logika-facts-with-sequences">Blueprint for Logika facts with sequences</h2>
<p>When writing a Logika fact that works with a sequence, we will have this general recursive definition:</p>
<ul>
<li>Base case: we have already processed all elements in the sequence</li>
<li>Recursive case: process one sequence element, and recursively process the rest</li>
</ul>
<p>We need some way to track what element we are ready to process, so in addition to having the Logika proof function take a sequence parameter, we will also have it take a parameter that stores how many elements we have left to process. We will use this template for our Logika fact:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>l&#34;&#34;&#34;{
</span></span><span style="display:flex;"><span>    fact
</span></span><span style="display:flex;"><span>        def factName(seqName: seqType, count: Z): returnType
</span></span><span style="display:flex;"><span>            = (baseCaseValue), if count == 0                    (factName0)
</span></span><span style="display:flex;"><span>            = (recursiveCaseValue), if count &gt; 0                (factNameN)
</span></span><span style="display:flex;"><span>}&#34;&#34;&#34;</span></span></code></pre></div><p>Where we have that:</p>
<ul>
<li><code>factName</code> is the name we give our Logika proof function</li>
<li><code>seqName</code> is the name of our sequence parameter, and <code>seqType</code> is its type (either <code>ZS</code> or <code>ZB</code>)</li>
<li><code>returnType</code> is the type of what we are calculating (most likely <code>Z</code> or <code>B</code>)</li>
<li><code>count</code> is the number of items left to process in the sequence. We will see that we will initially pass our sequence size as this parameter, so that all elements in the sequence will be processed.</li>
<li><code>(baseCaseValue)</code> is the value we want for our base case &ndash; if we have already processed all sequence elements</li>
<li><code>(recursiveCaseValue)</code> is the value we want for our recursive case. In this step, we want to process the current sequence element, <code>seqName(count-1)</code>, and then use the proof function to recursively evaluate the rest of the sequence (passing <code>count-1</code> as the number of items left to process).</li>
<li><code>(factName0)</code> is the name we are giving out base case definition, and <code>(factNameN)</code> is the name we are giving our recursive case definition. We will not need to refer to these name in our verification when we use symexe mode.</li>
</ul>
<p>You may notice that this format is slightly different than the format we used for Logika facts in section 9.4. We could also write our sequence Logika facts in that format, using quantifiers to describe ranges, but you will find that the above format is much more straightforward.</p>
<h2 id="logika-fact-for-sequence-sum">Logika fact for sequence sum</h2>
<p>We are now ready to write a Logika fact to describe the calculation of adding all elements in a sequence &ndash; the sum <code>list(0) + list(1) + ... + list(list.size - 1)</code> for some sequence <code>list</code>. We use the template above to write:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>l&#34;&#34;&#34;{
</span></span><span style="display:flex;"><span>    fact
</span></span><span style="display:flex;"><span>        def sumFact(seq: ZS, pos: Z): Z
</span></span><span style="display:flex;"><span>            = 0, if pos == 0                                    (sum0)
</span></span><span style="display:flex;"><span>            = seq(pos-1) + sumFact(seq, pos-1), if pos &gt; 0          (sumN)
</span></span><span style="display:flex;"><span>}&#34;&#34;&#34;</span></span></code></pre></div><h2 id="how-does-the-sequence-sum-fact-work">How does the sequence sum fact work?</h2>
<p>To see how this Logika proof function works for a particular sequence, seq is <code>ZS(5,4,2)</code>. If we were to calculate:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sumFact(seq, seq.size)</span></span></code></pre></div><p>Then <code>sumFact</code> would initially go into the recursive case, since <code>pos</code> is 3 (and is greater than 0). Thus we would have that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sumFact(seq, seq.size) = 2 + sumFact(seq, 2)</span></span></code></pre></div><p><code>sumFact(seq, 2)</code> would also go into the recursive case. Since <code>pos</code> is 2 in this case, it would evaluate to be: <code>4 + sumFact(seq, 1)</code>. Next, <code>sumFact(seq, 1)</code> would evaluate to be: <code>5 + sumFact(seq, 0)</code>, and then <code>sumFact(seq, 0)</code> would reach our base case and would evaluate to 0.</p>
<p>Since <code>sumFact(seq, 0)</code> is 0, we now have that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sumFact(seq, 1) = 5 + sumFact(seq, 0) = 5 + 0 = 5</span></span></code></pre></div><p>And then we can plug in 5 for <code>sumFact(seq, 1)</code> to get:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sumFact(seq, 2) = 4 + sumFact(seq, 1) = 4 + 5 = 9</span></span></code></pre></div><p>Lastly, we can use <code>sumFact(seq, 2) == 9</code> in our top-level calculation to get that:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sumFact(seq, seq.size) = 2 + sumFact(seq, 2) = 2 + 9 = 11</span></span></code></pre></div><p>And we see that <code>sumFact</code> has correctly described that the sum of all elements in our <code>ZS(5,4,2)</code> sequence is 11.</p>
<h2 id="finishing-the-sumseq-example">Finishing the <code>sumSeq</code> example</h2>
<p>Now that we have a Logika fact to describe the sum of all the elements in a sequence, we have enough information to write the postcondition and loop invariant for our <code>sumSeq</code> function.</p>
<p>For the function contract, we must consider:</p>
<ul>
<li><em>Precondition</em>: this function will work for all sizes of sequences. For an empty sequence, it will correctly return a sum of 0. We can omit the <code>requires</code> clause from the function contract.</li>
<li><code>modifies</code> clause: this function is NOT modifying its sequence parameter, so we can omit this clause</li>
<li><em>Postcondition</em>: the function is not changing the sequence, so we do not need to describe the final values of each sequence element. We <em>do</em> need to describe what value we are returning, and how it relates to the sequence. We want to use our <code>sumFact</code> proof function to describe that <code>result</code> (our return value) is the sum of all elements in <code>list</code> &ndash; that is, that <code>result == sumFact(list, list.size)</code>.</li>
</ul>
<p>For the loop invariant block, we notice that the loop is NOT changing the sequence. We must include:</p>
<ul>
<li><em>What we are doing with each sequence element, and how that relates to another variable</em>. We can see that <code>total</code> tracks the sum of all elements in the sequence so far &ndash; up to but not including position <code>i</code>. Similar to the postcondition, we want to use our <code>sumFact</code> proof function to claim that <code>small</code> is the sum of the first <code>i</code> elements in <code>list</code> &ndash; that is, that <code>small == sumFact(list, i)</code>.</li>
<li><em>Upper and lower bounds for position variables</em>. Here, <code>i</code> is our position variable. We see that it is initialized to 0, so we will claim that it is always greater than or equal to 0 and less than or equal to the list size.</li>
</ul>
<p>We can now complete the function contract and loop invariant for <code>seqSum</code>:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>import org.sireum.logika._
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>//What is this Logika fact saying?
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>//add all elements from position 0 up to but not including pos
</span></span><span style="display:flex;"><span>//sum(seq, seq.size) - defines adding ALL elements in seq
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>l&#34;&#34;&#34;{
</span></span><span style="display:flex;"><span>   fact
</span></span><span style="display:flex;"><span>       def sum(seq: ZS, pos: Z): Z
</span></span><span style="display:flex;"><span>           = 0, if pos == 0                                    (sum0)
</span></span><span style="display:flex;"><span>           = seq(pos-1) + sum(seq, pos-1), if pos &gt; 0          (sumN)
</span></span><span style="display:flex;"><span>}&#34;&#34;&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def seqSum(list: ZS): Z = {
</span></span><span style="display:flex;"><span>   l&#34;&#34;&#34;{
</span></span><span style="display:flex;"><span>       ensures
</span></span><span style="display:flex;"><span>           result == sum(list, list.size)
</span></span><span style="display:flex;"><span>   }&#34;&#34;&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   var i: Z = 0
</span></span><span style="display:flex;"><span>   var total: Z = 0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   while (i &lt; list.size) {
</span></span><span style="display:flex;"><span>       l&#34;&#34;&#34;{
</span></span><span style="display:flex;"><span>           invariant
</span></span><span style="display:flex;"><span>               //total is the sum of the first i elements
</span></span><span style="display:flex;"><span>               //total = list(0) + list(1) + ... + list(i-1)
</span></span><span style="display:flex;"><span>               total == sum(list, i)
</span></span><span style="display:flex;"><span>               i &gt;= 0
</span></span><span style="display:flex;"><span>               i &lt;= list.size
</span></span><span style="display:flex;"><span>           modifies total, i
</span></span><span style="display:flex;"><span>       }&#34;&#34;&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       total = total + list(i)
</span></span><span style="display:flex;"><span>       i = i + 1
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   return total
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>////////////// Calling code ///////////////////
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>var test: ZS = ZS(1,2,3,4)
</span></span><span style="display:flex;"><span>var added: Z = seqSum(test)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>assert(added == 10)</span></span></code></pre></div><p>If we test this program in Logika&rsquo;s symexe mode, the final assert will hold &ndash; we have enough information to know exactly the sum of a specific sequence.</p>

            <footer class="footline">

            </footer>
          </article>


        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Julie Thornton
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis301-textbook/-/commit/46850e632d55e2f4fef1211d32a04e8d827cd3ca">Jun 15, 2022</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis301/js/clipboard.min.js?1700084028" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis301/js/perfect-scrollbar.min.js?1700084028" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis301/js/theme.js?1700084028" defer></script>
  </body>
</html>
